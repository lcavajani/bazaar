---
apiVersion: kubeadm.k8s.io/v1beta2
caCertPath: /etc/kubernetes/pki/ca.crt
{% if inventory_hostname in groups['masters'] %}
controlPlane:
  localAPIEndpoint:
    advertiseAddress: {{ (ansible_facts[apiserver_listen_interface | replace("-", "_")]['ipv4']['address']) | default(ansible_facts['default_ipv4']['address']) }}
{% endif %}
discovery:
  bootstrapToken:
    apiServerEndpoint: {{ control_plane_endpoint }}
    token: {{ token }}
    unsafeSkipCAVerification: False
    caCertHashes:
    - sha256:{{ ca_cert_hash }}
  timeout: 8m0s
kind: JoinConfiguration
nodeRegistration:
  name: {{ ansible_hostname }}
{% include "templates/kubelet.yml.j2" %}
